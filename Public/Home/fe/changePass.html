<!doctype html>
<html lang="zxx">
<include file="./Public/Home/fe/base/head.html" />

<body>
<include file="./Public/Home/fe/base/loader.html" />

<div class="site-content">
    <include file="./Public/Home/fe/base/nav.html" />
    <div id="sticky-header"></div>
    <div class="page-title-area bg-primary" style="background-image: url('__HOME__/fe/static/images/shape-dot1.png')">
        <div class="shape-group">
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="page-header-content text-center">
                        <div class="page-header-caption">
                            <h2 class="page-title">Change Password</h2>
                        </div>
                        <div class="breadcrumb-area">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="../index.html">Home</a></li>
                                <li class="breadcrumb-item active">Change Password</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="user-signin-block ptb-120">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <div class="sing-in-mockup md-mrb-60">
                        <img src="__HOME__/fe/static/picture/signin-mockup.png" alt="Mockup">
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="user-register-area">
                        <div class="form-content">
                            <div class="form-header">
                                <h4 class="form-subheading">if you want to</h4>
                                <h2 class="heading">Change your Password</h2>
                            </div>
                            <form class="default-form signin-form" method="post" action="">
                                <div class="form-group">
                                    <button type="button"
                                            id="btn_SendEmailCode"
                                            class="btn btn-default btn-primary btn-block">
                                        Send Email Code</button>
                                </div>
                                <div class="form-group">
                                    <label for="EmailCode">Email Code</label>
                                    <input id="EmailCode" name="code" class="form-controller" type="number" placeholder="Email Check Code" value="" style="-webkit-appearance:none;-moz-appearance:textfield;">
                                </div>
                                <div class="form-group">
                                    <label for="PassWord">Password</label>
                                    <input id="PassWord" name="password" class="form-controller" type="password" placeholder="please type your new password">
                                </div>
                                <div class="form-group">
                                    <label for="RePassWord">Confirm Password</label>
                                    <input id="RePassWord" name="repassword" class="form-controller" type="password" placeholder="please type your new password again">
                                </div>
                                <div class="form-btn-group">
                                    <div class="form-login-area">
                                        <button id="submit" class="btn btn-default btn-primary">Change Password</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        toastr.options = {
            "debug": false,
            "progressBar": true,
            "positionClass": "toast-bottom-full-width",
            "onclick": null,
            "fadeIn": 300,
            "fadeOut": 1000,
            "timeOut": 5000,
            "extendedTimeOut": 1000
        }
        $(function () {

            //发送验证码
            $('#btn_SendEmailCode').click(function () {
                var email = "{$email}";
                if (email == '') {
                    layer.msg('email is empty');
                    return false;
                }

                layer.msg('Sending...', {time: 2000});

                $.ajax({
                    url: 'sendEmail.html',
                    data: {
                        email: email
                    },
                    type: 'POST',
                    dateJson: 'JSON',
                    success: function (resp) {
                        layer.closeAll();
                        layer.msg(resp.msg);
                    },
                    error: function (error) {
                        layer.closeAll();
                        layer.msg('Send Fail, Please Try Again');
                    }
                });

                return false;
            })

            //提交
            $('#submit').click(function () {
                var email = "{$email}";
                var emailCode = $('input[name="code"]').val();
                var password = $('input[name="password"]').val();
                var repassword = $('input[name="repassword"]').val();
                if (email == '') {
                    layer.msg('email is empty');
                    return false;
                }
                if (emailCode == '') {
                    layer.msg('email verify code is empty');
                    return false;
                }
                if (password == '') {
                    layer.msg('password is empty');
                    return false;
                }
                if (repassword == '') {
                    layer.msg('comfirm password is empty');
                    return false;
                }
                if (password != repassword) {
                    layer.msg('password is invalid');
                    return false;
                }

                layer.closeAll();
                layer.load(2, {
                    shade: [0.3,'#666']
                });

                $.ajax({
                    url: 'changePass',
                    data: {
                        code: emailCode,
                        password: password,
                        rpassword: repassword,
                    },
                    type: 'POST',
                    dataType: 'JSON',
                    success: function (resp) {
                        layer.closeAll();
                        layer.msg(resp.msg);
                        if (resp.code == 200) {
                            location.href = '/login/showLogin';
                        }
                    },
                    error: function (error) {
                        layer.closeAll();
                        layer.msg('Submit Fail, Please Try Again');
                    }
                });
                return false;
            });
        })
    </script>
    <include file="./Public/Home/fe/base/footer.html" />
</div>
</body>
</html>