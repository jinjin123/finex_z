var Maintain_getPending=setInterval(getPendingPurchaseOrderList,5000);$(document).ready(function(){getMyCurrencyList();var f=JSON.parse(localStorage.getItem("RefreshCurrency"));var d=$(".logoCache").data("cache");var a=$("#coinMoneyList li:nth-child(1)").attr("currency-name");var g=$("#coinMoneyList li:nth-child(1)").attr("currency-id");var b;var c,h,i;if(f!=null&&d=="P2P"){switch(f[0]){case null:h=g;getKlineDataRaw(a);b=a;break;default:h=f[0].currencyId}c="P2P";i=1}else{if(f!=null&&d=="C2C"){switch(f[1]){case null:h=g;getKlineDataRaw(a);break;default:h=f[1].currencyId}c="C2C";i=0}else{if(d==""){var e=$(".navbar-brand").attr("href").split("/")[1]||"UserCenter";switch(e){case"CtoCTransaction":c="C2C";h=f!=null&&f[1]!=null?f[1].currencyId:"";i=0;break;default:c="P2P";h=f!=null&&f[0]!=null?f[0].currencyId:"";i=1;break}}else{c=d=="P2P"?i=1:i=0;b=a;h=g}}}getCoinInfoList(h,c);target_public_aside(1,h,i)});$(function(){var b=setInterval(function(){if($(".copyBtn").length>0){clearInterval(b);var c=new Clipboard(".copyBtn");c.on("success",function(d){BottomalertBox("bottom",FZCG,"success","center","center")});c.on("error",function(d){BottomalertBox("bottom",FZSB,"fail","center","center")})}},500);$("body").on("click","#getMyCurrencyList",function(){var c=getMyCollection();check_user("/CoinTradeInfo/getCoinInfoList",{},"post").then(function(f){var g="";var e=f.coinInfoList;for(var d in e){if(in_array(e[d].currency_id,c)){g+=getCoinHtml(e[d],2)}}$("#tab-underline-profile3 .panel-body").html(g)})});$("body").on("click","#coinMoneyList .coinName",function(){var i=$(this);if(i.hasClass("active")){return}var k=$(".navbar-brand").attr("href").split("/")[1]||"UserCenter";var j="",d=0;switch(k){case"UserCenter":j="P2P";d=1;break;case"CtoCTransaction":j="C2C";d=0;break;default:return false}var f=localStorage.getItem("RefreshCurrency");var c,e;var g=[];var l=i.attr("currency-id");var m=i.attr("currency-name");target_public_aside(1,l,d);var h={type:"",currencyId:l,currencyName:m,};switch(j){case"P2P":h.type="P2P";c=h;break;case"C2C":h.type="C2C";e=h;break}if(f==null){g.push(c);g.push(e)}else{g=JSON.parse(f);switch(j){case"P2P":g[0]=c;break;case"C2C":g[1]=e;break}}localStorage.setItem("RefreshCurrency",JSON.stringify(g));getCoinInfoList(l,j)});$("body").on("click",".buyOrder",function(){if(Maintain(forbidOrder,P2P_Maintain_Place,P2P_Maintain_Pattern)){return}getBuyingInfo($(this))});$("body").on("click",".myCollection",function(){var e=$(this);var d=e.data("currency-id");var c=e.attr("collection-status");collectionMyCoin(e,d,c)});$("body").on("click",".NameAlert button.close",function(){if(tips!=2){$.ajax({type:"post",url:"/PersonalCenter/changeStatus"})}});var a=false;$("body").on("click",".coinSelect",function(){var c=$(this).parents("li.dropdown");if($(document).width()<1280){if(a){c.removeClass("open");a=false}else{c.addClass("open");a=true}}})});function target_public_aside(c,e,b){var d,a;if(c==1){d=$("#coinMoneyList .coinName[currency-id='"+e+"']");if(b==0){$(".change_ctoc_coin").text(d.attr("currency-name"))}}else{d=$("#coinMoneyList li:nth-child(1)")}a=d.attr("currency-name");$(".coinSelect").html(d.find("a").html()+'<i class="fa fa-angle-down"></i>');$("#coinMoneyList .coinName.active").removeClass("active");d.addClass("active");getKlineDataRaw(a);setTimeout(function(){var f=$(".currency-id-"+d.attr("currency-id")).text();if(f==""||f==null){f="0.00000000"}$(".aside_Currency_balance").text(f)},1000);$(".aside_Currency_content").text(d.attr("currency-name"))}function getPendingPurchaseOrderList(a){if(Maintain(listOrder,P2P_Maintain_Marketorder,P2P_Maintain_Pattern)){$("#dataPage_order_1").html("");$("#pendingOrder").html("");clearInterval(Maintain_getPending);return}var h=$("#getCurrencyId").val();var i=$("#buyAreaId").val();var e=$("#buyBankId").parents(".btn-group.bootstrap-select").children("button").html()?$("#buyBankId").val():"";var g=$("#num1").val();var f=$("#num2").val();var c=$("#price1").val();var b=$("#price2").val();if(a=="undefined"){a=1}var d={areaId:i,currencyId:h,bankId:e,num1:g,num2:f,price1:c,price2:b,p:a};check_user("/OffTrading/getPendingPurchaseOrderList",d,"get").then(function(k){if(k.code==200){var l="";var n=k.data.page_show;var m=k.data.order_list;for(var j in m){l+=getPendigOrderListHtml(m[j])}l+="<td ></td>";$("#dataPage_order_1").html(n);$("#pendingOrder").html(l)}else{BottomalertBox("bottom",k.msg,"fail","center")}});return d}function getPendigOrderListHtml(b){if(!b.level){b.level=0}var a="<tr>";a+="<td>"+b.bank_name+"</td>";a+='<td class="Lwprice">'+b.price+"</td>";a+='<td class="count">'+b.num+"</td>";a+='<td class="count">'+b.total_rate+"</td>";a+='<td><img src="/Public/Home/img/VIP_'+b.level+'.svg" width="53" /></td>';a+='<td class="active">';a+='<a class=" BuyOrder1"><i  class="buyOrder iconfont icon-cart"   currency-id="'+b.currency_id+'"';a+=' price="'+b.price+'" num="'+b.num+'" area-id="'+b.area_id+'" ';a+=' user-bank-id="'+b.bank_id+'" order-id="'+b.id+'"></i></a>';a+="</td>";a+="</tr>";return a}var ajaxPromise=new Promise(function(a){a()});function getBuyingInfo(a){ajaxPromise.then(function(){return isRealName()}).then(function(b){if(b.code==200){return checkTradePwd()}return b}).then(function(b){if(b.code==200){return checkIsOvertime()}return b}).then(function(b){if(b.code==200){var c=a.attr("currency-id");return checkIsCompleteOrder(c,1)}return b}).then(function(c){if(c.code==200){$("#buyTradePwd").val("");$("#buyVerifyCode").val("");var d=a.attr("area-id");var b=$("#defaultArra").val();if(d!=b){$("#otherArea").show();$("#areaTips").show()}else{$("#otherArea").hide();$("#areaTips").hide()}getBuyOrderBankInfo(a)}})}function isRealName(){return $.ajax({type:"post",url:"/checkUserInfo/isUserRealName",data:"",dataType:"json",error:function(a){},beforeSend:function(){},success:function(a){if(a.code!=200){alertBox(a.msg)}return a}})}function checkIsCompleteOrder(b,a){var c={currencyId:b,type:a};return $.ajax({type:"post",url:"/OffTrading/checkIsCompleteOrder",data:c,dataType:"json",async:false,error:function(d){},beforeSend:function(){},success:function(d){if(d.code!=200){BottomalertBox("bottom",d.msg,"fail","center")}return d}})}function checkIsOvertime(){return $.ajax({type:"post",url:"/checkUserInfo/checkUserIsOverTime",data:"",dataType:"json",async:false,error:function(a){},beforeSend:function(){},success:function(a){if(a.code!=200){BottomalertBox("bottom",a.msg,"fail","center")}}})}function checkTradePwd(){return $.ajax({type:"post",url:"/checkUserInfo/checkUserIsTradePwd",data:"",dataType:"json",error:function(a){},beforeSend:function(){},async:false,success:function(a){if(a.code!=200){alertBox(a.msg,($(document).width()/2),($(document).height()/2))}return a}})}function getBuyOrderBankInfo(g){var i=g.attr("currency-id");var a=g.attr("order-id");var d=g.attr("user-bank-id");var f=g.attr("price");var e=g.attr("num");var j=g.attr("area-id");var c=$("#currencyName").html();f=ChangeFixed(f,3);e=ChangeFixed(e,5);var h=f*e;h=ChangeFixed(h,3);var k=getPriceBychangeCoin(j);var b=h*k[1];b=ChangeFixed(b,3);if(j==2){b=ChangeFixed(b,1)+"00"}$("#buySubInfo").attr("buy-order-id",a).attr("user-bank-id",d).attr("currency-id",i);check_user("/OffTrading/getUserBankInfo",{order_id:a},"post").then(function(l){if(l.code==200){var m=l.data.bank_info;$("#buyBankName").text(m.bank_name).attr("user-bank-id",d);$("#buyCoinName").text(c);$("#buyPrice").text(f);$("#buyNum").text(e);$("#buyTotalMoney").text(h);$(".buyReferMoney-price").text(k[0]);$("#buyReferMoney").html(b);$("#static").modal("show")}else{BottomalertBox("bottom",l.msg,"fail","center")}})}function getDefaultCoin(c){var d=$("#userArea").val();var b=getPriceBychangeCoin(d);var a=c.last*b[1];a=ChangeFixed(a,3);if(d==2){a=ChangeFixed(a,1)+"00"}$("#referenceMoney").html(a);$("#nowMoney").html(ChangeFixed(c.last,3));$("#coinNameOrderList").html(c.coin_name);$("#getCurrencyId").val(c.currency_id);$("#currencyName").html(c.coin_name);$("#subSellInfo").attr("currency-id",c.currency_id);$("#coinHeighMoney").html(c.heigh);$("#coinLowMoney").html(c.low);$("#coinRtqMoney").html(c.rtq);$("#coinNameMoney").html(c.coin_name+"/USD");$("#coinTotalMoney").html(c.money_usa)}function getPriceBychangeCoin(d){var c,b,a;if(d==1){a=$("#hkdRate")}else{if(d==2){a=$("#twdRate")}else{a=$("#cnyRate")}}c=a.attr("unit");b=a.val();return[c,b]}function getMyCollection(){var a=null;$.ajax({type:"post",url:"/CoinTradeInfo/getMycollection",data:"",dataType:"json",error:function(b){},beforeSend:function(){},async:false,success:function(b){a=b.data.currency_arr}});return a}var XH_getCoinInfoList;function loop_getCoinInfoList(a){check_user("/CoinTradeInfo/getCoinInfoList",{currencyId:a},"post").then(function(d){var c=d.coinInfoList;var e="";for(var b in c){e+=getCoinHtml(c[b])}$("#tab-underline-home3 .panel-body").html(e)})}function getCoinInfoList(c,b){var d=0;var a=$("#coinMoneyList > li:nth-child(1)");c=c?c:a.attr("currency-id");check_user("/CoinTradeInfo/getCoinInfoList",{currencyId:c},"post").then(function(h){var g=h.coinInfoList;var f=h.checkCoinInfo;if(f.status==0){clear_data(b);return false}if(g!=false){var i="";for(var e in g){i+=getCoinHtml(g[e])}$("#tab-underline-home3 .panel-body").html(i);clearInterval(XH_getCoinInfoList)}else{XH_getCoinInfoList=setInterval(function(){loop_getCoinInfoList(c)},5000)}getDefaultCoin(f);if(/UserCenter/.test(window.location.href)&&/index/.test(window.location.href)){getPendingPurchaseOrderList(1,c)}else{clearInterval(Maintain_getPending)}$("#tab-underline-home3 .quoteprice_box[box-id='"+c+"']").addClass("active")})}function getMyCurrencyList(){check_user("/CoinTradeInfo/getUserCurrency",{},"post").then(function(b){var c="";var d=b.data.myCurrList;for(var a in d){c+=getCurrencyListHtml(d[a])}$("#myCurrencyList").append(c)})}function in_array(b,c){for(var a in c){if(c[a]==b){return true}}return false}function collectionMyCoin(c,b,a){check_user("/CoinTradeInfo/collectionMyCoin",{currency_id:b,collection_status:a},"post").then(function(d){if(d.code==200&&d.data.collection_status==0){BottomalertBox("bottom",d.msg,"fail","center");c.attr("collection-status","0").html('<use xlink:href="#icon-ic_left_collect_line"></use>')}else{if(d.code==200&&d.data.collection_status==1){BottomalertBox("bottom",d.msg,"success","center");c.attr("collection-status","1").html('<use xlink:href="#icon-ic_left_collect_fill"></use>')}}})}function getCurrencyListHtml(b){var a="<tr>";a+="<td>"+b.coin_name+"</td>";a+='<td class="text-right two_price"> <span class="currency-id-'+b.currency_id+'">'+b.num+"</span></td>";a+="</tr>";return a}function getCoinHtml(f,d){d=d?d:1;var b,e;if(f.perc_status>0){b="#4bd2b7";e="fa fa-long-arrow-up"}else{b="#e8653b";e="fa fa-long-arrow-down"}var c='<div class="quoteprice_box" box-id='+f.currency_id+"><ul>";c+='<li class="quote_coinname" >';c+='<div class="col-lg-6 col-md-6 col-xs-6 getImgicon"><svg class="icon icon_norepeat" aria-hidden="true"><use xlink:href="#icon-'+f.coin_name+'1"></use></svg>  '+f.coin_name+"</div>";c+='<div class="col-lg-6 col-md-6 col-xs-6 text-right">';if(d==1){var a;if(f.col_status==1){a="fill"}else{a="line"}c+='<a href="" id="tag02" data-toggle="tab" aria-expanded="false">';c+=' <svg collection-status="'+f.col_status+'"  aria-hidden="true" class="tag02 myCollection icon icon_norepeat"';c+=' data-currency-id="'+f.currency_id+'"><use xlink:href="#icon-ic_left_collect_'+a+'"></use></svg></a>'}c+="</div>";c+='<div class="clearfix"></div>';c+="</li>";c+='<li class="quote_nowprice text-center"><div class="col-lg-12" style="color:'+b+'">'+setZero(f.last_usa)+'</div><div class="clearfix"></div></li>';c+='<li class="quote_volume">';c+='<div class="col-lg-7 col-md-7 col-xs-7"><span class="font11">Volume:'+setZero(f.num)+" "+f.coin_name+"</span></div>";c+='<div class="col-lg-5 col-md-5 col-xs-5 text-right">';c+='<span class="font11">24H :</span><span class="vol_font font11" style="color:'+b+'">'+setZero(f.perc_per)+'  <i class="'+e+'"></i></span>';c+='<span class="kline"></span>';c+="</div>";c+='<div class="clearfix"></div>';c+="</li>";c+="</ul></div>";return c}function setZero(a){if(a==null){return 0}else{return a}}function getKlineDataRaw(a){$("#kline_iframe").attr("src","/TradingView/rawTrade/CoinType/"+a)};