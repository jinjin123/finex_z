tvApp.create(function(e,t){utils.getSymbol(e.baseUrl+e.api.symbol,t)},function(a){var d={httpData:{},widget:null,activeChart:null,getBarTimer:null,get interval(){return a.tradingView.option.interval},get symbol(){return a.tradingView.symbol.symbol},init:function(){d.initWeight()},initData:function(){var e=a.baseUrl+a.api.candles;utils.getCandles(e,this.symbol,utils.toSecond(this.interval),function(e){d.httpData[d.ticker]=e,d._socket.subscribe()})},initWeight:function(){this._socket.init(),a.tradingView.option=$.extend(this.option,a.tradingView.option,{datafeed:utils.datafeeds(this._datafeeds)}),this.initData(),this.widget=new TradingView.widget(a.tradingView.option),this.widget.onChartReady(function(){var t=this.activeChart(),e=localStorage.getItem("K_timeframe");t.setResolution(e||String(d.interval)),(d.activeChart=t).createStudy("Moving Average",!1,!1,[5],null,{"plot.color":"#09e"}),t.createStudy("Moving Average",!1,!1,[10],null,{"plot.color":"#dad553"}),t.onIntervalChanged().subscribe(null,function(e){d._socket.unSubscribe(),a.tradingView.option.interval=e,localStorage.setItem("K_timeframe",e),t.setResolution(e),d.initData()}),d.headerBar.init()})},get ticker(){return this.symbol+"-"+this.interval},get option(){var e=JSON.parse(localStorage.getItem("tv_chart_css")),t=e&&e.hasOwnProperty("tvColor")?e.tvColor:"light",r=1==/dark/.test(t)?"dark":"light",i=1==/dark/.test(t)?"#262a34":"#ffffff";return window.parent.$(document).ready(function(){document.getElementsByClassName("k-toolbar")[0].className="k-toolbar "+r+" "}),{symbol:"BTC-USDT",interval:5,user_id:"public_user_id",fullscreen:!0,autosize:!0,container_id:"trading-view",datafeed:null,custom_css_url:"../../css/custom.css",disabled_features:["save_chart_properties_to_local_storage","volume_force_overlay","header_saveload","header_symbol_search","header_chart_type","header_compare","header_undo_redo","timeframes_toolbar","countdown","caption_buttons_text_if_possible","use_localstorage_for_settings","compare_symbol"],enabled_features:["hide_last_na_study_output","hide_left_toolbar_by_default"],theme:r,timezone:"Asia/Shanghai",locale:"zh",overrides:{"paneProperties.background":i,"paneProperties.vertGridProperties.color":i,"paneProperties.horzGridProperties.color":i,"paneProperties.crossHairProperties.color":"#989898","paneProperties.crossHairProperties.width":1,"mainSeriesProperties.candleStyle.upColor":"#69c0ad","mainSeriesProperties.candleStyle.downColor":"#f25c6f","mainSeriesProperties.candleStyle.borderUpColor":"#69c0ad","mainSeriesProperties.candleStyle.borderDownColor":"#f25c6f","mainSeriesProperties.candleStyle.wickUpColor":"#69c0ad","mainSeriesProperties.candleStyle.wickDownColor":"#f25c6f","mainSeriesProperties.haStyle.upColor":"#69c0ad","mainSeriesProperties.haStyle.downColor":"#f25c6f","mainSeriesProperties.haStyle.borderDownColor":"#f25c6f","mainSeriesProperties.haStyle.borderUpColor":"#69c0ad","mainSeriesProperties.barStyle.upColor":"#69c0ad","mainSeriesProperties.barStyle.downColor":"#f25c6f"},studies_overrides:{"volume.volume.color.0":"#f25c6f","volume.volume.color.1":"#69c0ad"},customFormatters:{timeFormatter:{format:function(e){return moment(e).utc().format("HH:mm")}},dateFormatter:{format:function(e){return moment(e).utc().format("YYYY-MM-DD")}}}}},_socket:{self:utils.socket(a.socketUrl,{}),init:function(){this.self.doOpen(),this.self.on("message",this.onMessage)},sendMessage:function(e){var t=this;this.self.checkOpen()?this.self.send(e):this.self.on("open",function(){t.self.send(e)})},unSubscribe:function(){this.sendMessage({op:"unsubscribe",args:this.args})},subscribe:function(){this.sendMessage({op:"subscribe",args:this.args})},onMessage:function(e){if(e.data&&0<e.data.length){var t=e.data[e.data.length-1],r=utils.formatCandles([t.candle],utils.toSecond(d.interval))[0];if("object"==typeof d.httpData[d.ticker]){var i=d.httpData[d.ticker].length;d.httpData[d.ticker][i-1].time==r.time?d.httpData[d.ticker][i-1]=r:d.httpData[d.ticker].push(r)}a.tradingView.option.datafeed.barsUpdater.updateData()}},get args(){return["spot/candle"+utils.toSecond(d.interval)+"s:"+d.symbol]}},_datafeeds:{getConfig:function(){return a.tradingView.config},getSymbol:function(){return a.tradingView.symbol},getBars:function(e,t,r,i,a){var o=d.ticker;if(d.httpData[o]&&d.httpData[o].length){var n=[],s=d.httpData[o];for(var l in s)s[l].time>=1e3*r&&s[l].time<=1e3*i&&n.push(s[l]);a(n)}else{var c=this;d.getBarTimer=setTimeout(function(){c.getBars(e,t,r,i,a)},10)}}},headerBar:{init:function(){for(var e in this)"init"!=e&&this[e]()},fullscreen:function(){var e=1;$(".k-toolbar .fullscreen").click(function(){e=1==e?(window.parent.$(".panel-body.kline").addClass("addFullScreen"),window.parent.$(".panel-body.kline").css("cssText","height: 100%"),window.parent.$(".nopad.navbg").css({display:"none"}),2):(window.parent.$(".panel-body.kline").removeClass("addFullScreen"),window.parent.$(".panel-body.kline").css("cssText","height: 100%"),window.parent.$(".nopad.navbg").removeAttr("style"),$("iframe").css({height:"100%"}),1)})}}};d.init()});