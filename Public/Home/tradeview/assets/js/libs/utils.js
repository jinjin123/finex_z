window.utils={socket:function(e,t){var n={heartBeatTimer:null,options:t,messageMap:{},connState:0,socket:null,url:e,doOpen:function(){var t=this;if(!this.connState){this.connState=1;var e=new(window.WebSocket||window.MozWebSocket)(this.url);e.binaryType="arraybuffer",e.onopen=function(e){t.onOpen(e)},e.onclose=function(e){t.onClose(e)},e.onmessage=function(e){t.onMessage(e.data)},e.onerror=function(e){t.onError(e)},this.socket=e}},onOpen:function(e){this.connState=2,this.heartBeatTimer=setInterval(this.checkHeartbeat.bind(this),2e4),this.onReceiver({Event:"open"})},checkOpen:function(){return 2===this.connState},onClose:function(){this.connState=0,this.connState&&this.onReceiver({Event:"close"})},send:function(e){this.socket.send(JSON.stringify(e))},emit:function(e){return promise(function(t){n.socket.send(JSON.stringify(e)),n.on("message",function(e){t(e)})})},onMessage:function(e){e=pako.inflateRaw(e,{to:"string"});try{var t=JSON.parse(e);this.onReceiver({Event:"message",Data:t})}catch(e){console.error(" >> Data parsing error:",e)}},checkHeartbeat:function(){this.send("ping")},onError:function(e){},onReceiver:function(e){var t=this.messageMap[e.Event];t&&t(e.Data)},on:function(e,t){this.messageMap[e]=t},doClose:function(){this.socket.close()},destroy:function(){this.heartBeatTimer&&(clearInterval(this.heartBeatTimer),this.heartBeatTimer=null),this.doClose(),this.messageMap={},this.connState=0,this.socket=null}};return n},datafeeds:function(e){var s={self:e,barsUpdater:null,onReady:function(t){return new Promise(function(e,t){var n=s.defaultConfiguration();s.self.getConfig&&(n=Object.assign(s.defaultConfiguration(),s.self.getConfig())),e(n)}).then(function(e){t(e)})},resolveSymbol:function(e,t,n){return new Promise(function(e,t){var n=s.defaultSymbol();s.self.getSymbol&&(n=Object.assign(s.defaultSymbol(),s.self.getSymbol())),e(n)}).then(function(e){t(e)}).catch(function(e){n(e)})},getBars:function(e,t,n,s,r,i){this.self.getBars(e,t,n,s,function(e){e&&e.length?r(e,{noData:!0}):r([],{noData:!0})})},subscribeBars:function(e,t,n,s,r){this.barsUpdater.subscribeBars(e,t,n,s,r)},unsubscribeBars:function(e){this.barsUpdater.unsubscribeBars(e)},defaultConfiguration:function(){return{supports_search:!0,supports_group_request:!1,supported_resolutions:["1","5","15","30","60","1D","2D","3D","1W","1M"],supports_marks:!0,supports_timescale_marks:!0,supports_time:!0}},defaultSymbol:function(){return{name:"BTCUSDT",timezone:"Asia/Shanghai",minmov:1,minmov2:0,pointvalue:1,fractional:!1,session:"24x7",has_intraday:!0,has_no_volume:!1,description:"BTCUSDT",pricescale:1,ticker:"BTCUSDT",supported_resolutions:["1","5","15","30","60","1D","2D","3D","1W","1M"]}}};return s.barsUpdater=utils.dateUpdater(s),s},dateUpdater:function(e){var o={subscribers:{},requestsPending:0,historyProvider:e,subscribeBars:function(e,t,n,s){this.subscribers[s]={lastBarTime:null,listener:n,resolution:t,symbolInfo:e}},unsubscribeBars:function(e){delete this.subscribers[e]},updateData:function(){if(!this.requestsPending)for(var e in this.requestsPending=0,this.subscribers)this.requestsPending++,this.updateDataForSubscriber(e).then(function(){o.requestsPending--}).catch(function(){o.requestsPending--})},updateDataForSubscriber:function(i){return new Promise(function(t,e){var n=o.subscribers[i],s=parseInt((Date.now()/1e3).toString()),r=s-o.periodLengthSeconds(n.resolution,10);o.historyProvider.getBars(n.symbolInfo,n.resolution,r,s,function(e){o.onSubscriberDataReceived(i,e),t()},function(){e()})})},onSubscriberDataReceived:function(e,t){if(this.subscribers.hasOwnProperty(e)&&t.length){var n=t[t.length-1],s=this.subscribers[e];if(!(null!==s.lastBarTime&&n.time<s.lastBarTime)){if(null!==s.lastBarTime&&n.time>s.lastBarTime){if(t.length<2)throw new Error("Not enough bars in history for proper pulse update. Need at least 2.");var r=t[t.length-2];s.listener(r)}s.lastBarTime=n.time,s.listener(n)}}},periodLengthSeconds:function(e,t){return 24*("D"===e||"1D"===e?t:"M"===e||"1M"===e?31*t:"W"===e||"1W"===e?7*t:t*parseInt(e)/1440)*60*60}};return o},getSymbol:function(e,t){var n=this.query;$.ajax({url:e,data:n,dateType:"JSON",type:"GET",success:t})},getCandles:function(e,t,n,s){var r=this;$.ajax({url:e,data:{symbol:t,granularity:n},dateType:"JSON",type:"GET",success:function(e){if(0==e.code){var t=r.formatCandles(e.data,n);s(t)}else s([{time:0,open:0,high:0,low:0,close:0,volume:0}])}})},formatCandles:function(e){var t=arguments[1]||null,n=[];for(var s in e){var r=0;86400!=t&&604800!=t||(r=288e5);var i=parseInt(moment(e[s][0]).format("x"))+parseInt(r);n.push({time:i,open:parseFloat(e[s][1]),high:parseFloat(e[s][2]),low:parseFloat(e[s][3]),close:parseFloat(e[s][4]),volume:parseFloat(e[s][5])})}return n},toSecond:function(e){if(-1!==(e=e.toString()).indexOf("D")){var t=e.toString().split("D")[0];return 24*parseInt(t)*60*60}if(-1===e.indexOf("W"))return 60*parseInt(e);var n=e.toString().split("W")[0];return 7*parseInt(n)*24*60*60},get query(){var e=location.search,t=new Object;if(-1!=e.indexOf("?")){var n=e.substr(1);strs=n.split("&");for(var s=0;s<strs.length;s++)t[strs[s].split("=")[0]]=unescape(strs[s].split("=")[1])}return t}};